{"ast":null,"code":"import getRandomInt from '../js_utils/getRandomInt.js';\nexport default function fillRepos(state) {\n  let newState = { ...state\n  };\n\n  for (let i in newState.repos.slice(0, -1)) {\n    // last repo is the middle and should not be filled\n    let repoFilled = nMissingInRepo(newState, i) === 0;\n\n    while (!repoFilled) {\n      const randId = getRandomInt(0, newState.bag.length, nMissingInRepo(newState, i));\n      newState.repos[i] = newState.bag.filter((_, i) => randId.includes(i));\n      newState.bag = newState.bag.filter((_, i) => !randId.includes(i));\n      repoFilled = true;\n      const bagHasEnoughTiles = newState.bag.length >= newState.tilesPerRepo;\n\n      if (!bagHasEnoughTiles) {\n        newState = refillBag(newState);\n        const bagHasEnoughTilesNow = newState.bag.length >= newState.tilesPerRepo;\n\n        if (!bagHasEnoughTilesNow) {\n          throw new Error('There too few tiles in the game!');\n        }\n      }\n    }\n  }\n\n  return newState;\n}\n\nfunction refillBag(state) {\n  const newState = { ...state\n  };\n  newState.bag = newState.usedTiles;\n  newState.usedTiles = [];\n  return newState;\n}\n\nfunction nMissingInRepo(state, i) {\n  const nActual = state.repos[i].filter(el => el !== state.emptyTileField).length;\n  const nTarget = state.tilesPerRepo;\n  return nTarget - nActual;\n}","map":{"version":3,"names":["getRandomInt","fillRepos","state","newState","i","repos","slice","repoFilled","nMissingInRepo","randId","bag","length","filter","_","includes","bagHasEnoughTiles","tilesPerRepo","refillBag","bagHasEnoughTilesNow","Error","usedTiles","nActual","el","emptyTileField","nTarget"],"sources":["/home/lorenz/programming/repos/game_with_tiles/src/azul_lib/fillRepos.js"],"sourcesContent":["import getRandomInt from '../js_utils/getRandomInt.js'\n\nexport default function fillRepos(state) {\n\n\tlet newState = { ...state };\n\n\tfor (let i in newState.repos.slice(0,-1)) {// last repo is the middle and should not be filled\n\t\tlet repoFilled = (nMissingInRepo(newState,i)===0);\n\t\twhile (!repoFilled) {\n\t\t\tconst randId = getRandomInt(\n\t\t\t\t0,\n\t\t\t\tnewState.bag.length,\n\t\t\t\tnMissingInRepo(newState,i)\n\t\t\t);\n\t\t\tnewState.repos[i] = newState.bag.filter((_,i) => randId.includes(i));\n\t\t\tnewState.bag = newState.bag.filter((_,i) => !(randId.includes(i)));\n\t\t\trepoFilled = true;\n\t\t\tconst bagHasEnoughTiles = (newState.bag.length >= newState.tilesPerRepo);\n\t\t\tif (!bagHasEnoughTiles) {\n\t\t\t\tnewState = refillBag(newState);\n\t\t\t\tconst bagHasEnoughTilesNow = (newState.bag.length >= newState.tilesPerRepo);\n\t\t\t\tif (!bagHasEnoughTilesNow) {\n\t\t\t\t\tthrow new Error('There too few tiles in the game!');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn newState\n}\n\nfunction refillBag(state) {\n\tconst newState = { ...state };\n\n\tnewState.bag = newState.usedTiles;\n\tnewState.usedTiles = [];\n\n\treturn newState\n}\n\nfunction nMissingInRepo(state,i) {\n\tconst nActual = state.repos[i].filter(el => el !== state.emptyTileField).length;\n\tconst nTarget = state.tilesPerRepo;\n\treturn nTarget-nActual\n}"],"mappings":"AAAA,OAAOA,YAAP,MAAyB,6BAAzB;AAEA,eAAe,SAASC,SAAT,CAAmBC,KAAnB,EAA0B;EAExC,IAAIC,QAAQ,GAAG,EAAE,GAAGD;EAAL,CAAf;;EAEA,KAAK,IAAIE,CAAT,IAAcD,QAAQ,CAACE,KAAT,CAAeC,KAAf,CAAqB,CAArB,EAAuB,CAAC,CAAxB,CAAd,EAA0C;IAAC;IAC1C,IAAIC,UAAU,GAAIC,cAAc,CAACL,QAAD,EAAUC,CAAV,CAAd,KAA6B,CAA/C;;IACA,OAAO,CAACG,UAAR,EAAoB;MACnB,MAAME,MAAM,GAAGT,YAAY,CAC1B,CAD0B,EAE1BG,QAAQ,CAACO,GAAT,CAAaC,MAFa,EAG1BH,cAAc,CAACL,QAAD,EAAUC,CAAV,CAHY,CAA3B;MAKAD,QAAQ,CAACE,KAAT,CAAeD,CAAf,IAAoBD,QAAQ,CAACO,GAAT,CAAaE,MAAb,CAAoB,CAACC,CAAD,EAAGT,CAAH,KAASK,MAAM,CAACK,QAAP,CAAgBV,CAAhB,CAA7B,CAApB;MACAD,QAAQ,CAACO,GAAT,GAAeP,QAAQ,CAACO,GAAT,CAAaE,MAAb,CAAoB,CAACC,CAAD,EAAGT,CAAH,KAAS,CAAEK,MAAM,CAACK,QAAP,CAAgBV,CAAhB,CAA/B,CAAf;MACAG,UAAU,GAAG,IAAb;MACA,MAAMQ,iBAAiB,GAAIZ,QAAQ,CAACO,GAAT,CAAaC,MAAb,IAAuBR,QAAQ,CAACa,YAA3D;;MACA,IAAI,CAACD,iBAAL,EAAwB;QACvBZ,QAAQ,GAAGc,SAAS,CAACd,QAAD,CAApB;QACA,MAAMe,oBAAoB,GAAIf,QAAQ,CAACO,GAAT,CAAaC,MAAb,IAAuBR,QAAQ,CAACa,YAA9D;;QACA,IAAI,CAACE,oBAAL,EAA2B;UAC1B,MAAM,IAAIC,KAAJ,CAAU,kCAAV,CAAN;QACA;MACD;IACD;EACD;;EAED,OAAOhB,QAAP;AACA;;AAED,SAASc,SAAT,CAAmBf,KAAnB,EAA0B;EACzB,MAAMC,QAAQ,GAAG,EAAE,GAAGD;EAAL,CAAjB;EAEAC,QAAQ,CAACO,GAAT,GAAeP,QAAQ,CAACiB,SAAxB;EACAjB,QAAQ,CAACiB,SAAT,GAAqB,EAArB;EAEA,OAAOjB,QAAP;AACA;;AAED,SAASK,cAAT,CAAwBN,KAAxB,EAA8BE,CAA9B,EAAiC;EAChC,MAAMiB,OAAO,GAAGnB,KAAK,CAACG,KAAN,CAAYD,CAAZ,EAAeQ,MAAf,CAAsBU,EAAE,IAAIA,EAAE,KAAKpB,KAAK,CAACqB,cAAzC,EAAyDZ,MAAzE;EACA,MAAMa,OAAO,GAAGtB,KAAK,CAACc,YAAtB;EACA,OAAOQ,OAAO,GAACH,OAAf;AACA"},"metadata":{},"sourceType":"module"}