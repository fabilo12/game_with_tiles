{"ast":null,"code":"import finishRound from '../azul_lib/finishRound.js';\nexport default function putTilesIntoRow(state, payload) {\n  let newState = { ...state\n  };\n  const isValidRow = checkRowValidity(state, payload);\n\n  if (isValidRow) {\n    newState = processDrawnTiles(newState, payload);\n    newState = putRestToMiddle(newState);\n    newState = emptyRepo(newState);\n    newState = takeStartingTile(newState);\n    newState = deleteSelectedTiles(newState);\n    newState = goToNextPlayer(newState);\n    const isRoundOver = newState.repos.every(el => el.every(el => el === newState.emptyTileField));\n\n    if (isRoundOver) {\n      newState = finishRound(newState);\n    }\n  } else {\n    alert('Choose another row, please! Only empty rows or rows with tiles of the same color as the selected tile color are possible. Furthermore, rows that were already filled with the selected color are forbidden. If no row is possible, please click on a penalty button!');\n  }\n\n  return newState;\n}\n\nfunction checkRowValidity(state, payload) {\n  if (!payload.hasOwnProperty('row')) {\n    return true;\n  }\n\n  const rowIsEmpty = state.rows[state.playerAtTurn][payload.row][0] === state.emptyTileField;\n  const rowHasSameColor = state.rows[state.playerAtTurn][payload.row][0] === state.selectedTiles.color;\n  const wallRowContainsColor = state.wall[state.playerAtTurn][payload.row].includes(state.selectedTiles.color);\n  return (rowIsEmpty || rowHasSameColor) && !wallRowContainsColor;\n}\n\nfunction processDrawnTiles(state, payload) {\n  const newState = { ...state\n  };\n  const drawn = newState.repos[newState.selectedTiles.repo].filter(el => el === newState.selectedTiles.color);\n  let targetRow;\n\n  if (!payload.hasOwnProperty('row')) {\n    targetRow = [];\n  } else {\n    targetRow = newState.rows[newState.playerAtTurn][payload.row];\n  }\n\n  const nTileInRow = targetRow.filter(el => el === drawn[0]).length;\n  const nDrawn = drawn.length;\n  const auxFilled = Array(Math.min(nTileInRow + nDrawn, targetRow.length)).fill(drawn[0]);\n  const auxEmpty = Array(targetRow.length - auxFilled.length).fill(state.emptyTileField);\n\n  if (payload.hasOwnProperty('row')) {\n    newState.rows[newState.playerAtTurn][payload.row] = auxFilled.concat(auxEmpty);\n  }\n\n  newState.penalties[newState.playerAtTurn].push(...Array(Math.max(0, nDrawn - (targetRow.length - nTileInRow))).fill(drawn[0]));\n  return newState;\n}\n\nfunction putRestToMiddle(state) {\n  const newState = { ...state\n  };\n\n  if (newState.selectedTiles.repo !== newState.nRepos) {\n    const rest = newState.repos[newState.selectedTiles.repo].filter(el => el !== newState.selectedTiles.color);\n    newState.repos[newState.nRepos] = newState.repos.at(-1).concat(rest);\n  }\n\n  return newState;\n}\n\nfunction emptyRepo(state) {\n  const newState = { ...state\n  };\n\n  if (newState.selectedTiles.repo === newState.nRepos) {\n    //tiles taken from middle\n    newState.repos[newState.selectedTiles.repo] = newState.repos[newState.selectedTiles.repo].filter(el => el !== newState.selectedTiles.color);\n  } else {\n    newState.repos[newState.selectedTiles.repo] = Array(newState.tilesPerRepo).fill(newState.emptyTileField);\n  }\n\n  return newState;\n}\n\nfunction takeStartingTile(state) {\n  const newState = { ...state\n  };\n  const startingTileInMiddle = newState.startingTile === 'middle';\n  const drawnFromMiddle = newState.selectedTiles.repo === newState.nRepos;\n\n  if (startingTileInMiddle && drawnFromMiddle) {\n    newState.startingTile = 'player' + newState.playerAtTurn;\n  }\n\n  return newState;\n}\n\nfunction deleteSelectedTiles(state) {\n  const newState = { ...state\n  };\n  delete newState.selectedTiles;\n  return newState;\n}\n\nfunction goToNextPlayer(state) {\n  const newState = { ...state\n  };\n  newState.playerAtTurn = (newState.playerAtTurn + 1) % newState.nPlayer;\n  return newState;\n}","map":{"version":3,"names":["finishRound","putTilesIntoRow","state","payload","newState","isValidRow","checkRowValidity","processDrawnTiles","putRestToMiddle","emptyRepo","takeStartingTile","deleteSelectedTiles","goToNextPlayer","isRoundOver","repos","every","el","emptyTileField","alert","hasOwnProperty","rowIsEmpty","rows","playerAtTurn","row","rowHasSameColor","selectedTiles","color","wallRowContainsColor","wall","includes","drawn","repo","filter","targetRow","nTileInRow","length","nDrawn","auxFilled","Array","Math","min","fill","auxEmpty","concat","penalties","push","max","nRepos","rest","at","tilesPerRepo","startingTileInMiddle","startingTile","drawnFromMiddle","nPlayer"],"sources":["/home/lorenz/programming/game_with_tiles/src/reducer/putTilesIntoRow.js"],"sourcesContent":["import finishRound from '../azul_lib/finishRound.js'\n\nexport default function putTilesIntoRow(state, payload) {\n\n\tlet newState = { ...state };\n\n\tconst isValidRow = checkRowValidity(state, payload);\n\n\tif (isValidRow) {\n\t\tnewState = processDrawnTiles(newState, payload);\n\t\tnewState = putRestToMiddle(newState);\n\t\tnewState = emptyRepo(newState);\n\t\tnewState = takeStartingTile(newState);\n\t\tnewState = deleteSelectedTiles(newState);\n\t\tnewState = goToNextPlayer(newState);\n\t\tconst isRoundOver = newState.repos.every(\n\t\t\tel => el.every(el => el===newState.emptyTileField)\n\t\t);\n\t\tif (isRoundOver) {\n\t\t\tnewState = finishRound(newState);\n\t\t}\n\t} else {\n\t\talert('Choose another row, please! Only empty rows or rows with tiles of the same color as the selected tile color are possible. Furthermore, rows that were already filled with the selected color are forbidden. If no row is possible, please click on a penalty button!')\n\t}\n\n\treturn newState\n}\n\nfunction checkRowValidity(state, payload) {\n\t\n\tif (!payload.hasOwnProperty('row')) {\n\t\treturn true\n\t}\n\tconst rowIsEmpty = (\n\t\tstate.rows[state.playerAtTurn][payload.row][0] === state.emptyTileField\n\t);\n\tconst rowHasSameColor = (\n\t\tstate.rows[state.playerAtTurn][payload.row][0] === state.selectedTiles.color\n\t);\n\tconst wallRowContainsColor = (\n\t\tstate.wall[state.playerAtTurn][payload.row].includes(state.selectedTiles.color)\n\t);\n\n\treturn (rowIsEmpty || rowHasSameColor) && !wallRowContainsColor\n}\n\nfunction processDrawnTiles(state, payload) {\n\n\tconst newState = { ...state };\n\n\tconst drawn = newState.repos[newState.selectedTiles.repo].filter(\n\t\tel => el === newState.selectedTiles.color\n\t);\n\tlet targetRow\n\tif (!payload.hasOwnProperty('row')) {\n\t\ttargetRow = [];\n\t} else {\n\t\ttargetRow = newState.rows[newState.playerAtTurn][payload.row];\n\t}\n\tconst nTileInRow = targetRow.filter(el => el === drawn[0]).length;\n\tconst nDrawn = drawn.length;\n\tconst auxFilled = Array(Math.min(nTileInRow + nDrawn, targetRow.length)).fill(drawn[0]);\n\tconst auxEmpty = Array(targetRow.length - auxFilled.length).fill(state.emptyTileField);\n\tif (payload.hasOwnProperty('row')) {\n\t\tnewState.rows[newState.playerAtTurn][payload.row] = auxFilled.concat(auxEmpty);\n\t}\n\tnewState.penalties[newState.playerAtTurn].push(\n\t\t...Array(Math.max(0, nDrawn - (targetRow.length - nTileInRow))).fill(drawn[0])\n\t);\n\n\treturn newState\n}\n\nfunction putRestToMiddle(state) {\n\n\tconst newState = { ...state };\n\n\tif (newState.selectedTiles.repo !== newState.nRepos) {\n\t\tconst rest = newState.repos[newState.selectedTiles.repo].filter(\n\t\t\tel => el!==newState.selectedTiles.color\n\t\t)\n\t\tnewState.repos[newState.nRepos] = newState.repos.at(-1).concat(rest);\n\t}\n\n\treturn newState\n}\n\nfunction emptyRepo(state) {\n\t\n\tconst newState = { ...state };\n\n\tif (newState.selectedTiles.repo === newState.nRepos) {//tiles taken from middle\n\t\tnewState.repos[newState.selectedTiles.repo] = \n\t\t\tnewState.repos[newState.selectedTiles.repo].filter(\n\t\t\t\tel => el!==newState.selectedTiles.color\n\t\t\t);\n\t} else {\n\t\tnewState.repos[newState.selectedTiles.repo] = \n\t\tArray(newState.tilesPerRepo).fill(newState.emptyTileField);\n\t}\n\t\n\treturn newState\n}\n\n\nfunction takeStartingTile(state) {\n\n\tconst newState = { ...state };\n\n\tconst startingTileInMiddle = (newState.startingTile === 'middle');\n\tconst drawnFromMiddle = (newState.selectedTiles.repo === newState.nRepos);\n\tif (startingTileInMiddle && drawnFromMiddle) {\n\t\tnewState.startingTile = 'player' + newState.playerAtTurn;\n\t}\n\n\treturn newState\n}\n\nfunction deleteSelectedTiles(state) {\n\n\tconst newState = { ...state };\n\n\tdelete newState.selectedTiles;\n\t\n\treturn newState\n}\n\nfunction goToNextPlayer(state) {\n\n\tconst newState = { ...state };\n\n\tnewState.playerAtTurn = (newState.playerAtTurn + 1) % newState.nPlayer;\n\n\treturn newState\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}