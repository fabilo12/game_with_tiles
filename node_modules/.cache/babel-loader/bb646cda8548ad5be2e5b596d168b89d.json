{"ast":null,"code":"import addArrays from '../js_utils/addArrays.js';\nimport tileColToDist from '../azul_lib/tileColToDist.js';\nexport default function putTilesIntoRow(state, payload) {\n  let newState = { ...state\n  };\n  newState = processDrawnTiles(newState, payload);\n  newState = putRestToMiddle(newState);\n  newState = emptyRepo(newState);\n  newState = deleteSelectedTiles(newState);\n  newState = goToNextPlayer(newState);\n  newState = takeStartingTile(newState);\n  return newState;\n}\n\nfunction processDrawnTiles(state, payload) {\n  const newState = { ...state\n  };\n  const drawn = newState.repos[newState.selectedTiles.repo].filter(el => el === newState.selectedTiles.color);\n  const targetRow = newState.rows[newState.playerAtTurn][payload.row];\n  const nTileInRow = targetRow.filter(el => el === drawn[0]).length;\n  const nDrawn = drawn.length;\n  const auxFilled = Array(Math.min(nTileInRow + nDrawn, targetRow.length)).fill(drawn[0]);\n  const auxEmpty = Array(targetRow.length - auxFilled.length).fill(state.emptyTileField);\n  newState.rows[newState.playerAtTurn][payload.row] = auxFilled.concat(auxEmpty);\n  newState.penalties[newState.playerAtTurn] = addArrays(newState.penalties[newState.playerAtTurn], tileColToDist(Array(Math.max(0, nDrawn - (targetRow.length - nTileInRow))).fill(drawn[0]), state.nColor));\n  return newState;\n}\n\nfunction putRestToMiddle(state) {\n  const newState = { ...state\n  };\n\n  if (newState.selectedTiles.repo !== newState.nRepos) {\n    const rest = newState.repos[newState.selectedTiles.repo].filter(el => el !== newState.selectedTiles.color);\n    newState.repos[newState.nRepos] = newState.repos.at(-1).concat(rest);\n  }\n\n  return newState;\n}\n\nfunction emptyRepo(state) {\n  const newState = { ...state\n  };\n\n  if (newState.selectedTiles.repo === newState.nRepos) {\n    //tiles taken from middle\n    newState.repos[newState.selectedTiles.repo] = newState.repos[newState.selectedTiles.repo].filter(el => el !== newState.selectedTiles.color);\n  } else {\n    newState.repos[newState.selectedTiles.repo] = Array(newState.tilesPerRepo).fill(newState.emptyTileField);\n  }\n\n  return newState;\n}\n\nfunction deleteSelectedTiles(state) {\n  const newState = { ...state\n  };\n  delete newState.selectedTiles;\n  return newState;\n}\n\nfunction goToNextPlayer(state) {\n  const newState = { ...state\n  };\n  newState.playerAtTurn = (newState.playerAtTurn + 1) % newState.nPlayer;\n  return newState;\n}\n\nfunction takeStartingTile() {\n  const newState = { ...state\n  };\n  newState.startingTile = (newState.playerAtTurn + 1) % newState.nPlayer;\n  return newState;\n}\n/*if (newState.drawn.length > 0) {\n\tif (payload.repo === 'middle') {\n\t\tnewState[payload.repo] = Array(newState.nColors).fill(0);\n\t\tif (newState.startingTile === 'middle') {\n\t\t\tnewState.startingTile = newState.playerAtTurn;\n\t\t}\n\t} else {\n\t\tnewState.middle = addArrays(newState.middle, tileColToDist(tiles.filter(c => c !== color)));\n\t\tnewState[payload.repo] = [];\n\t}\n\treturn newState;\n} else {\n\talert(payload.repo + \" contains no tile of color \" + color.toString() + \"!\");\n}*/","map":{"version":3,"names":["addArrays","tileColToDist","putTilesIntoRow","state","payload","newState","processDrawnTiles","putRestToMiddle","emptyRepo","deleteSelectedTiles","goToNextPlayer","takeStartingTile","drawn","repos","selectedTiles","repo","filter","el","color","targetRow","rows","playerAtTurn","row","nTileInRow","length","nDrawn","auxFilled","Array","Math","min","fill","auxEmpty","emptyTileField","concat","penalties","max","nColor","nRepos","rest","at","tilesPerRepo","nPlayer","startingTile"],"sources":["/home/lorenz/programming/azul_create_react_app/src/reducer/putTilesIntoRow.js"],"sourcesContent":["import addArrays from '../js_utils/addArrays.js'\nimport tileColToDist from '../azul_lib/tileColToDist.js'\n\nexport default function putTilesIntoRow(state, payload) {\n\n\tlet newState = { ...state };\n\n\tnewState = processDrawnTiles(newState, payload);\n\tnewState = putRestToMiddle(newState);\n\tnewState = emptyRepo(newState);\n\tnewState = deleteSelectedTiles(newState);\n\tnewState = goToNextPlayer(newState);\n\tnewState = takeStartingTile(newState);\n\n\treturn newState\n}\n\nfunction processDrawnTiles(state, payload) {\n\n\tconst newState = { ...state };\n\n\tconst drawn = newState.repos[newState.selectedTiles.repo].filter(\n\t\tel => el === newState.selectedTiles.color\n\t);\n\tconst targetRow = newState.rows[newState.playerAtTurn][payload.row];\n\tconst nTileInRow = targetRow.filter(el => el === drawn[0]).length;\n\tconst nDrawn = drawn.length;\n\tconst auxFilled = Array(Math.min(nTileInRow + nDrawn, targetRow.length)).fill(drawn[0]);\n\tconst auxEmpty = Array(targetRow.length - auxFilled.length).fill(state.emptyTileField);\n\tnewState.rows[newState.playerAtTurn][payload.row] = auxFilled.concat(auxEmpty);\n\tnewState.penalties[newState.playerAtTurn] = addArrays(\n\t\tnewState.penalties[newState.playerAtTurn],\n\t\ttileColToDist(\n\t\t\tArray(Math.max(0, nDrawn - (targetRow.length - nTileInRow))).fill(drawn[0]), \n\t\t\tstate.nColor\n\t\t)\n\t);\n\n\treturn newState\n}\n\nfunction putRestToMiddle(state) {\n\n\tconst newState = { ...state };\n\n\tif (newState.selectedTiles.repo !== newState.nRepos) {\n\t\tconst rest = newState.repos[newState.selectedTiles.repo].filter(\n\t\t\tel => el!==newState.selectedTiles.color\n\t\t)\n\t\tnewState.repos[newState.nRepos] = newState.repos.at(-1).concat(rest);\n\t}\n\n\treturn newState\n}\n\nfunction emptyRepo(state) {\n\t\n\tconst newState = { ...state };\n\n\tif (newState.selectedTiles.repo === newState.nRepos) {//tiles taken from middle\n\t\tnewState.repos[newState.selectedTiles.repo] = \n\t\t\tnewState.repos[newState.selectedTiles.repo].filter(\n\t\t\t\tel => el!==newState.selectedTiles.color\n\t\t\t);\n\t} else {\n\t\tnewState.repos[newState.selectedTiles.repo] = \n\t\tArray(newState.tilesPerRepo).fill(newState.emptyTileField);\n\t}\n\t\n\treturn newState\n}\n\nfunction deleteSelectedTiles(state) {\n\n\tconst newState = { ...state };\n\n\tdelete newState.selectedTiles;\n\t\n\treturn newState\n}\n\nfunction goToNextPlayer(state) {\n\n\tconst newState = { ...state };\n\n\tnewState.playerAtTurn = (newState.playerAtTurn + 1) % newState.nPlayer;\n\n\treturn newState\n}\n\n\nfunction takeStartingTile() {\n\n\tconst newState = { ...state };\n\n\tnewState.startingTile = (newState.playerAtTurn + 1) % newState.nPlayer;\n\n\treturn newState\n}\n\n\n\n/*if (newState.drawn.length > 0) {\n\tif (payload.repo === 'middle') {\n\t\tnewState[payload.repo] = Array(newState.nColors).fill(0);\n\t\tif (newState.startingTile === 'middle') {\n\t\t\tnewState.startingTile = newState.playerAtTurn;\n\t\t}\n\t} else {\n\t\tnewState.middle = addArrays(newState.middle, tileColToDist(tiles.filter(c => c !== color)));\n\t\tnewState[payload.repo] = [];\n\t}\n\treturn newState;\n} else {\n\talert(payload.repo + \" contains no tile of color \" + color.toString() + \"!\");\n}*/\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}